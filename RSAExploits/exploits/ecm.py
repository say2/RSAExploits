sage_present = True
try:
	from sage.all_cmdline import *
except ImportError:
	sage_present = False

from RSAExploits.util import compute_private_RSA_exp
from RSAExploits.factoring_common import long_cal
from Exploit import Exploit

class _ecm(Exploit):

	def run(self, rsadata_list):
	
		global sage_present
	
		if not sage_present:
			print "ECM Factoring: Sage required, skipping exploit"
			return 
		
		print ("ECM Factoring: Running Attack...")
		success = False

		for rsadata in rsadata_list:
			roots = long_cal(300, rsadata.getN(), ecm.factor)
			if roots != None:
				rsadata.setD(compute_private_RSA_exp(rsadata.getE(), roots))
				success = True
	
		if success:		
			print("ECM Factoring: Success, roots found, assigned in rsadata.")
			return True							
		else: 			
			print("ECM Factoring: Failure, roots not found.")
			return False

