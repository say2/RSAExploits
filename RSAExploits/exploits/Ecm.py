sage_present = True
try:
	from sage.all_cmdline import *
except ImportError:
	sage_present = False

from RSAExploits.util import compute_priv_rsa_exp
from Exploit import Exploit

class Ecm(Exploit):

	def run(self, rsadata_list):
	
		global sage_present
	
		if not sage_present:
			print "ECM Factoring: Sage required, skipping exploit"
			return 
		
		print ("ECM Factoring: Running Attack...")
		success = False

		for rsadata in rsadata_list:
			roots = ecm.factor(rsadata.get_n())
			if roots != None:
				rsadata.set_d(compute_priv_rsa_exp(rsadata.get_e(), roots))
				success = True
	
		if success:		
			print("ECM Factoring: Success, roots found, assigned in rsadata.")
			return True							
		else: 			
			print("ECM Factoring: Failure, roots not found.")
			return False

